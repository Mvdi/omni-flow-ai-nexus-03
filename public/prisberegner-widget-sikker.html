<!-- === WORDPRESS KOMPATIBEL PRISBEREGNER === -->
<!-- Kopiér hele denne blok ind i en WordPress side/indlæg eller Custom HTML block -->
<meta charset="UTF-8">
<div id="prisboks-wp" style="width:100%;max-width:530px;margin:auto;font-family:'Poppins',sans-serif;background:linear-gradient(145deg, #ffffff, #f8fafc);border:1px solid #E2E8F0;box-shadow:0 10px 40px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.04);border-radius:12px;overflow:hidden;transform:translateY(0);transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);" onmouseover="this.style.transform='translateY(-4px) scale(1.02)';this.style.boxShadow='0 20px 60px rgba(0,0,0,.12), 0 4px 16px rgba(0,0,0,.08)'" onmouseout="this.style.transform='translateY(0) scale(1)';this.style.boxShadow='0 10px 40px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.04)'">
  <!-- Header -->
  <div style="background:linear-gradient(135deg, #2D4B73 0%, #1e3a5f 100%);color:#fff;padding:1.25rem;font-weight:600;font-size:1.1rem;box-shadow:0 2px 10px rgba(45, 75, 115, 0.15);transition:all 0.3s ease;">Algebehandling af tag</div>
  
  <!-- TRIN 1: Prisberegning -->
  <div id="trin1-wp">
    <!-- Ikoner -->
    <div style="display:flex;justify-content:space-around;padding:1rem;font-size:.85rem;border-bottom:1px solid #f1f5f9;text-align:center;background:linear-gradient(to bottom, #ffffff, #fafbfc);">
      <div style="color:#64748b;transition:transform 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">&#x1F9FD;<br>Stopper mos & alger</div>
      <div style="color:#64748b;transition:transform 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">&#x1F6E1;&#xFE0F;<br>Forebygger genvækst</div>
      <div style="color:#64748b;transition:transform 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">&#x2728;<br>Fornyet tagoverflade</div>
    </div>
    <!-- Gul rabatboks -->
    <div id="rabatboks-wp" style="background:linear-gradient(135deg, #FFE86E 0%, #FFDF47 100%);color:#1C1C1C;padding:1rem;font-weight:600;text-align:center;font-size:.95rem;box-shadow:0 2px 8px rgba(255, 232, 110, 0.3);border-top:1px solid rgba(255, 223, 71, 0.5);border-bottom:1px solid rgba(255, 223, 71, 0.5);">
      Ved at tegne aftalen sparer du <span style="color:#00539B;font-weight:700;" id="besparelse-wp">200 kr.</span> på første behandling!
    </div>
    <!-- Beregner -->
    <div style="padding:1.5rem;">
      <label for="arealValg-wp" style="display:block;font-weight:500;margin-bottom:.75rem;font-size:.95rem;color:#374151;">Vælg interval</label>
      <select id="arealValg-wp" onchange="toggleM2InputSimple();updatePriceSimple();" style="width:100%;padding:.75rem;border:2px solid #e5e7eb;border-radius:8px;margin-bottom:1.5rem;font-size:.95rem;background:#fafbfc;outline:none;transition:all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6';this.style.boxShadow='0 0 0 2px rgba(59, 130, 246, 0.2)'" onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'" onmouseover="this.style.borderColor='#60a5fa'" onmouseout="this.style.borderColor='#e5e7eb'">
        <option value="0">Op til 100 m²</option>
        <option value="1">101‑250 m²</option>
        <option value="2">Over 250 m² (indtast præcist areal)</option>
      </select>
      <!-- M² input for over 250 -->
      <div id="m2Input-wp" class="animate-scale-in" style="display:none;margin-bottom:1.5rem;opacity:0;transform:scale(0.95);transition:all 0.3s ease;">
        <label style="display:block;font-weight:500;margin-bottom:.75rem;font-size:.95rem;color:#374151;">Indtast antal m²</label>
        <input type="number" id="customM2-wp" min="251" value="251" oninput="updatePriceSimple()" style="width:100%;padding:.75rem;border:2px solid #e5e7eb;border-radius:8px;font-size:.95rem;background:#fafbfc;outline:none;transition:all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6';this.style.boxShadow='0 0 0 2px rgba(59, 130, 246, 0.2)'" onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'" onmouseover="this.style.borderColor='#60a5fa'" onmouseout="this.style.borderColor='#e5e7eb'">
      </div>
      <label style="display:flex;align-items:flex-start;margin-bottom:1.25rem;font-weight:500;font-size:.95rem;">
        <input type="checkbox" id="vedligehold-wp" onchange="updatePriceSimple()" style="margin-right:8px;margin-top:4px;">Tilføj årlig vedligeholdelsesaftale <span style="font-size:.9rem;color:#555;font-weight:400;">(Pris: <span id="vedlPris-wp">795</span> kr.)</span>
      </label>
      <div style="font-size:.85rem;margin-bottom:1.25rem;line-height:1.5;">
        Vi kan tilbyde en årlig serviceaftale, som inkluderer:
        <ul style="margin-top:.5rem;padding-left:1.2rem;">
          <li>Årlig forebyggende behandling, der holder taget rent og flot.</li>
          <li>Beskytter mod genvækst og forlænger tagets levetid.</li>
        </ul>
        <em style="display:block;margin-top:.75rem;color:#777;font-style:italic;">Første servicebehandling finder sted i efteråret næste år og gentages hvert år.</em>
      </div>
      <!-- Prisfelt -->
      <div style="background:#2D4B73;color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center;font-size:.95rem;margin-bottom:1rem;">
        <span style="font-weight:500;">Pris første behandling</span>
        <span><s id="førPris-wp" style="opacity:.5;font-size:.85rem;margin-right:.5rem;">995 kr.</s><strong id="prisVisning-wp">795 kr.</strong></span>
      </div>
      <div style="text-align:center;">
        <button type="button" onclick="visKundeoplysningerSimple()" style="background:#2D4B73;color:#fff;padding:.75rem 1.1rem;font-weight:600;border:none;cursor:pointer;border-radius:6px;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(45,75,115,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 20px rgba(45,75,115,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(45,75,115,0.3)'">Næste</button>
      </div>
    </div>
  </div>

  <!-- TRIN 2: Kundeoplysninger -->
  <div id="trin2-wp" style="display:none;padding:1.5rem;">
    <div style="margin-bottom:1rem;">
      <button type="button" onclick="visPrisberegningSimple()" style="background:none;border:none;color:#2D4B73;cursor:pointer;font-size:.9rem;text-decoration:underline;">
        ← Tilbage til prisberegning
      </button>
    </div>
    
    <h3 style="margin:0 0 1rem 0;font-size:1.1rem;color:#2D4B73;">Indtast dine oplysninger</h3>
    <form id="tilbudsform-wp" onsubmit="sendTilWebhookSimple(event)" style="display:flex;flex-direction:column;gap:1rem;">
      <div style="display:flex;gap:0.5rem;">
        <input type="text" id="fornavn-wp" placeholder="Fornavn" required style="flex:1;padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
        <input type="text" id="efternavn-wp" placeholder="Efternavn" required style="flex:1;padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
      </div>
      <input type="email" id="email-wp" placeholder="Email" required style="padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
      <input type="tel" id="telefon-wp" placeholder="Telefonnummer" required style="padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
      <div style="display:flex;gap:0.5rem;">
        <input type="text" id="by-wp" placeholder="By" required style="flex:1;padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
        <input type="text" id="postnummer-wp" placeholder="Postnummer" required style="flex:1;padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
      </div>
      <input type="text" id="adresse-wp" placeholder="Adresse" required style="padding:.75rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem;">
      <label style="display:flex;align-items:flex-start;font-size:.85rem;color:#555;gap:8px;">
        <input type="checkbox" required style="margin-top:2px;">
        Jeg har læst og accepterer handelsbetingelserne
      </label>
      <button type="submit" style="background:#2D4B73;color:#fff;padding:.75rem;font-weight:600;border:none;border-radius:4px;cursor:pointer;font-size:.95rem;">Bestil tid</button>
    </form>
    <div id="besked-wp" style="margin-top:1rem;font-weight:500;font-size:.9rem;"></div>
  </div>
</div>

<script>
// Simpel funktioner direkte i global scope for WordPress
function toggleM2InputSimple() {
  console.log('toggleM2InputSimple kaldt');
  var ddl = document.getElementById('arealValg-wp');
  var m2Input = document.getElementById('m2Input-wp');
  
  console.log('Dropdown element:', ddl);
  console.log('M2Input element:', m2Input);
  console.log('Dropdown værdi:', ddl ? ddl.value : 'ikke fundet');
  
  if (ddl && m2Input) {
    if (ddl.value === '2') {
      console.log('Viser m2Input - sætter display til block');
      m2Input.style.display = 'block';
      m2Input.style.visibility = 'visible';
      // Smooth animation
      setTimeout(function() {
        m2Input.style.opacity = '1';
        m2Input.style.transform = 'scale(1)';
      }, 10);
    } else {
      console.log('Skjuler m2Input - sætter display til none');
      m2Input.style.opacity = '0';
      m2Input.style.transform = 'scale(0.95)';
      setTimeout(function() {
        m2Input.style.display = 'none';
      }, 300);
    }
  } else {
    console.log('Kunne ikke finde dropdown eller m2Input element');
  }
  updatePriceSimple();
}

function updatePriceSimple() {
  var ddl = document.getElementById('arealValg-wp');
  var chk = document.getElementById('vedligehold-wp');
  var out = document.getElementById('prisVisning-wp');
  var før = document.getElementById('førPris-wp');
  var vedlPris = document.getElementById('vedlPris-wp');
  var customM2 = document.getElementById('customM2-wp');
  var besparelseEl = document.getElementById('besparelse-wp');
  
  if (!ddl || !chk || !out || !før || !vedlPris || !customM2 || !besparelseEl) return;
  
  var sel = ddl.value;
  var add = chk.checked;
  var std = 0, ved = 0;
  var savings = 200;
  
  if (sel === '0') {
    std = 995;
    ved = 795;
    vedlPris.textContent = '795';
  } else if (sel === '1') {
    std = 1395;
    ved = 1195;
    vedlPris.textContent = '1195';
  } else if (sel === '2') {
    var m2 = parseInt(customM2.value) || 251;
    var extraM2 = Math.max(0, m2 - 250);
    var extraCost = extraM2 * 10;
    var baseStandardPrice = 1395;
    var baseMaintenancePrice = 1195;
    
    std = baseStandardPrice + extraCost;
    var discountedExtraCost = extraCost * 0.8;
    ved = baseMaintenancePrice + discountedExtraCost;
    
    vedlPris.textContent = Math.round(ved).toLocaleString('da-DK');
    
    if (add) {
      var extraSavings = extraCost * 0.2;
      savings = 200 + extraSavings;
    }
  }
  
  besparelseEl.textContent = Math.round(savings) + ' kr.';
  
  var pris = add ? ved : std;
  out.textContent = Math.round(pris).toLocaleString('da-DK') + ' kr.';
  før.textContent = Math.round(std).toLocaleString('da-DK') + ' kr.';
  før.style.textDecoration = add ? 'line-through' : 'none';
  før.style.opacity = add ? '.5' : '0';
}

function visKundeoplysningerSimple() {
  document.getElementById('trin1-wp').style.display = 'none';
  document.getElementById('trin2-wp').style.display = 'block';
}

function visPrisberegningSimple() {
  document.getElementById('trin2-wp').style.display = 'none';
  document.getElementById('trin1-wp').style.display = 'block';
  var beskedEl = document.getElementById('besked-wp');
  if (beskedEl) beskedEl.textContent = '';
}

function sendTilWebhookSimple(e) {
  e.preventDefault();
  
  var beskedEl = document.getElementById('besked-wp');
  var submitBtn = e.target.querySelector('button[type="submit"]');
  
  if (!beskedEl || !submitBtn) return;
  
  submitBtn.disabled = true;
  submitBtn.textContent = 'Sender...';
  beskedEl.textContent = '';
  
  var fornavn = document.getElementById('fornavn-wp').value.trim();
  var efternavn = document.getElementById('efternavn-wp').value.trim();
  var navn = (fornavn + ' ' + efternavn).trim();
  var email = document.getElementById('email-wp').value.trim();
  var telefon = document.getElementById('telefon-wp').value.trim();
  var adresse = document.getElementById('adresse-wp').value.trim();
  var postnummer = document.getElementById('postnummer-wp').value.trim();
  var by = document.getElementById('by-wp').value.trim();
  var fullAdresse = (adresse + ', ' + postnummer + ' ' + by).trim();
  
  var ddl = document.getElementById('arealValg-wp');
  var chk = document.getElementById('vedligehold-wp');
  var prisEl = document.getElementById('prisVisning-wp');
  
  var interval = ddl.options[ddl.selectedIndex].text;
  var vedligeholdelse = chk.checked;
  var beregnetPris = prisEl.textContent;
  
  fetch('https://tckynbgheicyqezqprdp.supabase.co/functions/v1/prisberegner-webhook', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      navn: navn,
      email: email,
      telefon: telefon,
      adresse: fullAdresse,
      interval: interval,
      vedligeholdelse: vedligeholdelse,
      beregnet_pris: beregnetPris
    })
  })
  .then(function(response) {
    return response.json();
  })
  .then(function(result) {
    if (!result.success) {
      throw new Error(result.error || 'Ukendt fejl');
    }

    beskedEl.style.color = '#2D4B73';
    beskedEl.textContent = result.message || 'Tak! Vi har modtaget din forespørgsel og vender tilbage hurtigst muligt.';
    document.getElementById('tilbudsform-wp').reset();
    
    setTimeout(function() {
      visPrisberegningSimple();
      document.getElementById('arealValg-wp').value = '0';
      document.getElementById('vedligehold-wp').checked = false;
      updatePriceSimple();
    }, 2000);
  })
  .catch(function(error) {
    console.error('Fejl ved indsendelse:', error);
    beskedEl.style.color = '#e74c3c';
    beskedEl.textContent = 'Der opstod en fejl. Prøv venligst igen.';
  })
  .finally(function() {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Bestil tid';
  });
}

// Initialize med det samme
updatePriceSimple();
</script>